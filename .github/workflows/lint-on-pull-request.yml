name: Lint source tree on pull request on dev branch

on:
  pull_request:
    paths: [ '*.rpy' ]
    branches: [ dev ]

jobs:
  compile-submod:
    runs-on: ubuntu-latest

    env:
      SDL_AUDIODRIVER: dummy

    steps:

      - name: Checkout
        uses: actions/checkout@v2

      - name: Download DDLC/MAS package
        env:
          DL_CREDENTIALS: ${{ secrets.DL_CREDENTIALS }}
        run: .github/scripts/fetch-ddlc-mas.sh

      - name: Download Ren'Py SDK
        run: .github/scripts/fetch-renpy-sdk.sh

      - name: Store submod version in an environment variable
        run: echo "VERSION=$(.github/scripts/extract-version.sh)" >> $GITHUB_ENV

      - name: Compile submod
        run: .github/scripts/compile-submod.sh
